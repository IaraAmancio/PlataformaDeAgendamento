<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento</title>
    <link rel="stylesheet" href="/style/formulario.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container">
        <h3>Agendamento</h3>
        <form action="/submit-formulario" method="post">
            <div>
                <label for="nome">Nome:</label>
                <input type="text" id="nome" name="nome" autocomplete="name" required/>
            </div>
            <div>
                <label for="cpf">CPF:</label>
                <input type="text" id="cpf" name="cpf" autocomplete="off" required>
            </div>
            <div>
                <label for="email">E-mail:</label>
                <input type="email" id="email" name="email" autocomplete="email" required/>
            </div>
            <div>
                <label for="qtdPessoas">Quantidade de pessoas:</label>
                <input type="number" id="qtdPessoas" name="qtdPessoas" required/>
            </div>
            <div>
                <label for="dataReserva">Data da reserva:</label>
                <input type="date" id="dataReserva" name="dataReserva" min="" required>
            </div>
            <div>
                <label for="horarioReserva">Horário da Reserva:</label>
                <select name="horarioReserva" id="horarioReserva" name="horarioReserva" required>
                    <option value="18:00">18:00</option>
                    <option value="18:30">18:30</option>
                    <option value="19:00">19:00</option>
                    <option value="19:30">19:30</option>
                    <option value="20:00">20:00</option>
                    <option value="20:30">20:30</option>
                    <option value="21:00">21:00</option>
                    <option value="21:30">21:30</option>
                    <option value="22:00">22:00</option>
                </select>
            </div>
            <div class="setores">
                <label for="setores">Setor:</label>
                <select name="setor" id="setores" required>
                    <option value="Lounge Area">Lounge Area</option>
                    <option value="Internal Area">Internal Area</option>
                    <option value="External Area">External Area</option>
                </select>
            </div>
            <div class="button">
                <button type="submit">Enviar sua mensagem</button>
            </div>
        </form>
    </div>
    <script>

        const today =  new Date().toISOString().split('T')[0];
        const hours =  new Date().getHours();

        // limitar ao usuario 15 dias a partir do dia inicial, sendo considerado o dia inicial a data de hoje, até as 14h.
        let datelimit = new Date();     
        let dateinit = new Date();
        let reservationdays = hours < 14? 14: 15;
        let initday = hours < 14? 0 : 1;

        dateinit.setDate(dateinit.getDate() + initday);
        datelimit.setDate(datelimit.getDate() + reservationdays);
        datelimit = datelimit.toISOString().split('T')[0];
        dateinit = dateinit.toISOString().split('T')[0];

        document.getElementById('dataReserva').setAttribute('min', dateinit);
        document.getElementById('dataReserva').setAttribute('max', datelimit);
      

        $(document).ready(function() {
            $('#cpf').on('blur', function() {
                const cpf = $(this).val();
                $.ajax({
                    url: '/preenchimento-nome',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ cpf: cpf }),
                    success: function(response) {
                        if (response.success && response.nome) {
                            $('#nome').val(response.nome);
                        } else {
                            alert('CPF não encontrado');
                        }
                    },
                    error: function() {
                        alert('Erro ao buscar o CPF');
                    }
                });
            });
        });
    </script>
</body>
</html>